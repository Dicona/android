<!--
 Copyright 2021 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<div [class.loading-mask]="isModulesLoading">
  <!-- TODO: Add filter -->

  <div class="empty" *ngIf="!moduleResultNodes.length">
    No modules found.
  </div>

  <!-- Header row -->
  <table class="mat-table">
    <!-- TODO: Header should be sticky -->
    <thead class="mat-header-row">
      <th class="mat-header-cell" fxFlex="400px">Module</th>
      <th class="mat-header-cell" fxFlex="180px">Result</th>
      <th class="mat-header-cell" fxFlex="180px">Passed/Total</th>
      <th class="mat-header-cell failure-message-column" fxFlex>Failure Message</th>
    </thead>
  </table>

  <div *ngFor="let moduleNode of moduleResultNodes; index as i" class="module-section">
    <div class="module-row row-divider">
      <div fxFlex="400px" class="inline overflow">
        <button mat-icon-button aria-label="Toggle">
          <mat-icon class="mat-icon-rtl-mirror expand-button" (click)="expandModule(i)">
            {{moduleNode.expanded ? 'expand_more' : 'chevron_right'}}
          </mat-icon>
        </button>
        Module: <span class="module-name" [title]="moduleNode.moduleResult.name">
          {{moduleNode.moduleResult.name}}
        </span>
      </div>

      <div fxFlex="180px" class="result-text-padding">
        <div *ngIf="moduleNode.moduleResult.failed_tests">
          <mat-icon color='error' class='inline result-error-icon'>error</mat-icon>
          {{moduleNode.moduleResult.failed_tests}}
        </div>
      </div>

      <div fxFlex="180px" class="count-text-padding">
        {{moduleNode.moduleResult.passed_tests}}/{{moduleNode.moduleResult.total_tests}}
      </div>

      <div fxFlex><!-- Filler for failure message column --></div>
    </div>

    <!-- Display test cases when expanded -->
    <div *ngIf="moduleNode.expanded">
      <div *ngFor="let testCase of moduleNode.testCaseResults" class="row-divider">
        <div fxFlex="400px" class="testcase-text-padding">
          <div class='testcase-row-indent overflow'>
            Test: <span class='testcase-name' [title]="testCase.name">
            {{testCase.name}}
            </span>
          </div>
        </div>

        <div fxFlex="180px">
          <status-button [state]="getStatusString(testCase)"></status-button>
        </div>

        <div fxFlex="180px"><!-- Filler for counts column --></div>

        <div fxFlex class="failure-message testcase-text-padding overflow"
             [title]="testCase.error_message">
          {{testCase.error_message}}
        </div>
      </div> <!-- end ngFor testcaseresults -->

      <!-- Load more test cases button -->
      <div *ngIf="moduleNode.nextPageToken" class="testcase-row-indent row-divider">
        <!-- TODO: Add Viewing x of x section -->
        <button mat-button class="load-test-cases-button" (click)="loadMoreTestCases(i)"
                [disabled]='moduleNode.isLoading'>
          {{moduleNode.isLoading ? 'Loading...' : 'Load more'}}
        </button>
      </div>

    </div> <!-- end ngIf moduleNode.expanded -->

  </div>
</div>
